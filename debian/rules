#!/usr/bin/make -f

DEB_AUTO_UPDATE_LIBTOOL := pre
DEB_AUTO_UPDATE_ACLOCAL := 1.11
DEB_AUTO_UPDATE_AUTOCONF := no

# Documentation to install
DEB_INSTALL_DOCS_ALL = debian/TODO.Debian

VERSION=$(shell dpkg-parsechangelog | grep Version | cut -d ' ' -f 2 | cut -d '-' -f 1)

# Rules for build directly from upstream source packages (.tgz)
# This doesn't work sanely now, see TODO.Debian
DEB_TAR_SRCDIR := torcs-$(VERSION)
include /usr/share/cdbs/1/rules/tarball.mk

# rules for package building
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/rules/simple-patchsys.mk
include /usr/share/cdbs/1/class/autotools.mk

DEB_CONFIGURE_EXTRA_FLAGS := --bindir=\$${prefix}/games --x-libraries=/usr/lib/

# Nasty hack to get this target call configure script before compile
# the code. This should be improved/removed/cleaned, see TODO.Debian
debian/stamp-makefile-build:
	$(DEB_CONFIGURE_INVOKE) $(cdbs_configure_flags) $(DEB_CONFIGURE_EXTRA_FLAGS) $(DEB_CONFIGURE_USER_FLAGS)
	$(DEB_MAKE_INVOKE) $(DEB_MAKE_BUILD_TARGET)
	touch debian/stamp-makefile-build

cleanbuilddir/torcs::
	rm -f $(CURDIR)/debian/stamp*

binary-predeb/torcs::
# removing empty script until it's ready
	rm -f debian/torcs/usr/share/games/torcs/telemetry/telemetry.sh
# removing shipped Makefiles 
	find debian/torcs/usr/share/games/torcs -type f -name Makefile | xargs --no-run-if-empty rm -f
